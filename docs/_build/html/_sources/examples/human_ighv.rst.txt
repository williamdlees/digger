..human_ighv:

Annotating the human IGHV locus
===============================

The IGHV locus in the human reference assembly GRCh38.p12 has been annotated by IMGT. In this example, we will annotate with Digger and compare results.

Data
****

The locus and IMGT annotations can be downloaded and parsed with :ref:`parse_imgt_annotations`::

   > parse_imgt_annotations \
       --save_sequence IMGT000035.fasta \
	   "http://www.imgt.org/ligmdb/view?format=IMGT&id=IMGT000035" \
	   IMGT000035_genes.csv \
	   IGH 

This will create two files: ``IMGT000035.fasta``, containing the assembly sequence, and ``IMGT000035_genes.csv``, containing the co-ordinates of the IMGT-annotated genes, and sequences of their flanking regions.

The human IGH reference set can be downloaded from IMGT with the `receptor_utils <https://williamdlees.github.io/receptor_utils/_build/html/introduction.html>`__ command ``extract_refs`` (receptor_utils is installed as part of Digger's installation)::

   > extract_refs -L IGH "Homo sapiens"
   
This creates the reference sets ``Homo_sapiens_IGHV_gapped.fasta``, ``Homo_sapiens_IGHV.fasta``, ``Homo_sapiens_IGHD.fasta``, ``Homo_sapiens_IGHJ.fasta``, ``Homo_sapiens_CH.fasta``
   
Lastly, we need to make a combined file containing all the IGH V, D and J reference genes::

   > cat Homo_sapiens_IGHV.fasta Homo_sapiens_IGHD.fasta Homo_sapiens_IGHJ.fasta \
       > Homo_sapiens_IGHVDJ.fasta
   

Annotating the Assembly
***********************

With the data in place, we can instruct digger to perform the annotation::

   > digger IMGT000035.fasta \
       -v_ref Homo_sapiens_IGHV.fasta \
	   -d_ref Homo_sapiens_IGHD.fasta \
	   -j_ref Homo_sapiens_IGHJ.fasta \
	   -v_ref_gapped Homo_sapiens_IGHV_gapped.fasta \
	   -ref imgt,Homo_sapiens_IGHVDJ.fasta \
	   -species human \
	   -locus IGH \
	   IMGT000035.csv

the -v_ref, -d_ref, -j_ref and -V_ref_gapped arguments provide the reference assembly sequences. 

The -ref argument instructs Digger to compare any sequences it identifies in the assembly with those in the combined reference
set. It will create columns in the output assembly containing the nearest reference sequence found, % identity and so on. These columns will be prefixed 'imgt' as specified in this argument. Multiple -ref arguments can be 
passed to Digger, allowing comparison with multiple reference sets.

The -species argument tells Digger to use its internal position-weighted matrices for human loci, and -locus specifies the locus.

The output file will be ``IMGT000035.csv``.

References
**********

Lefranc et al., 2015, IMGT®, the international ImMunoGeneTics information system® 25 years on. *Nucleic Acids Res.* `doi: 10.1093/nar/gku1056 <https://doi.org/10.1093%2Fnar%2Fgku1056>`__.

Watson et al., 2013, Complete haplotype sequence of the human immunoglobulin heavy-chain variable, diversity, and joining genes and characterization of allelic and copy-number variation. *Am J Hum Genet* `doi: 10.1016/j.ajhg.2013.03.004 <http://dx.doi.org/10.1016/j.ajhg.2013.03.004>`__

Schneider et al., 2017, Evaluation of GRCh38 and de novo haploid genome assemblies demonstrates the enduring quality of the reference assembly. *Genome Research* `doi: 10.1101/gr.213611.116 <https://genome.cshlp.org/content/27/5/849>`__